<h2 class="section-title"><%= t('titles.boards') %></h2>

<!-- ▼ソート（左）＆検索フォーム（右）を横並びに -->
<div class="search-and-sort" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5em;">
  <!-- ソートタブ（左） -->
  <div class="sort-tabs">
    <%= link_to '新着順', boards_path(sort: 'new', q: params[:q]), class: (@sort == 'new' ? 'active-sort' : '') %> |
    <%= link_to '閲覧数順', boards_path(sort: 'view', q: params[:q]), class: (@sort == 'view' ? 'active-sort' : '') %>
  </div>
  <!-- キーワード検索フォーム（右） -->
  <div class="board-search-form" style="position: relative;">
    <%= form_with url: boards_path, method: :get, local: true do %>
      <input type="text" id="board-search-input" name="q" value="<%= params[:q] %>" placeholder="キーワード検索" autocomplete="off" />
      <button type="submit">検索</button>
    <% end %>
    <!-- オートコンプリート候補を表示するための領域 -->
    <ul id="autocomplete-list" style="position: absolute; background: white; border: 1px solid #ccc; z-index: 10; width: 100%;"></ul>
  </div>
</div>
<!-- ▲ここまで -->

<% if params[:q].present? %>
  <div class="search-result-info" style="margin-bottom: 1em;">
    「<%= params[:q] %>」の検索結果
  </div>
<% end %>

<div class="board-grid">
  <% @boards.each do |board| %>
    <div class="board-card">
      <%= image_tag(board.image.attached? ? url_for(board.image) : 'noimage.png', alt: board.title, class: "board-thumbnail") %>
      <h3><%= link_to board.title, board_path(board) %></h3>

      <div class="board-author">
        <%= link_to user_path(board.user), class: "user-link" do %>
          <div class="user-info">
            <% if board.user.profile_image.attached? %>
              <%= image_tag board.user.profile_image, class: "user-icon" %>
            <% else %>
              <%= image_tag 'user_icon.png', class: "user-icon" %>
            <% end %>
            <span class="user-name"><%= board.user.name %></span>
          </div>
        <% end %>
      </div>

      <!-- ▼ここにブックマークボタンを追加 -->
      <div id="bookmark-button-<%= board.id %>" data-turbo-frame="bookmark-button-<%= board.id %>">
        <%= render partial: "boards/bookmark", locals: { board: board, current_user: current_user } %>
      </div>
      <!-- ▲ここまで -->

    </div>
  <% end %>
</div>

<div class="pagination">
  <%= paginate @boards %>
</div>
